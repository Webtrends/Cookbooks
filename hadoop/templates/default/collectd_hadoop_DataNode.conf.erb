##############################################################################
# This file is autogenerated by chef                                         #
#                                                                            #
# Collectd Hadoop Data Node plugin configuration file                        #
#----------------------------------------------------------------------------#
# By: Josh Behrends - Webtrends 2012                                         #
#                                                                            #
# Revisions: 05/24/2012 - Initial script creation                            #
#                                                                            #
##############################################################################
LoadPlugin java
 
<Plugin "java">
       JVMArg "-verbose:jni"
       JVMArg "-Djava.class.path=/usr/share/collectd/java/collectd-api.jar:/usr/share/collectd/java/generic-jmx.jar"
       LoadPlugin "org.collectd.java.GenericJMX"
 
       <Plugin "GenericJMX">
       ################
       # MBean blocks #
       ################
       # Memory usage by memory pool.
       <MBean "memory_pool">
               ObjectName "java.lang:type=MemoryPool,*"
               InstancePrefix "memory_pool-"
               InstanceFrom "name"
               <Value>
                       Type "memory"
                       #InstancePrefix ""
                       #InstanceFrom ""
                       Table true
                       Attribute "Usage"
               </Value>
       </MBean>
       # Heap memory usage
       <MBean "memory-heap">
               ObjectName "java.lang:type=Memory"
               #InstanceFrom ""
               InstancePrefix "memory-heap"
               # Creates four values: committed, init, max, used
               <Value>
                       Type "memory"
                       #InstancePrefix ""
                       #InstanceFrom ""
                       Table true
                       Attribute "HeapMemoryUsage"
               </Value>
       </MBean>
       # Non-heap memory usage
       <MBean "memory_nonheap">
               ObjectName "java.lang:type=Memory"
               #InstanceFrom ""
               InstancePrefix "memory-nonheap"
               # Creates four values: committed, init, max, used
               <Value>
                       Type "memory"
                       #InstancePrefix ""
                       #InstanceFrom ""
                       Table true
                       Attribute "NonHeapMemoryUsage"
               </Value>
       </MBean>
       # Non-heap memory usage
       <MBean "java_threads">
               ObjectName "java.lang:type=Threading"
               #InstanceFrom ""
               InstancePrefix "java_threads"
               <Value>
                       Type "gauge"
                       InstancePrefix "ThreadCount"
                       #InstanceFrom ""
                       Attribute "ThreadCount"
               </Value>
       </MBean>
       # Garbage Collector stats
       <MBean "garbage_collector">
               ObjectName "java.lang:type=GarbageCollector,*"
               InstancePrefix "gc-"
               InstanceFrom "name"
               <Value>
                       Type "invocations"
                       InstancePrefix "collection_count"
                       #InstanceFrom ""
                       Table false
                       Attribute "CollectionCount"
               </Value>
               <Value>
                       Type "total_time_in_ms"
                       InstancePrefix "collection_time"
                       #InstanceFrom ""
                       Table false
                       Attribute "CollectionTime"
               </Value>
       </MBean>
       # Number of classes being loaded.
       <MBean "classes">
               ObjectName "java.lang:type=ClassLoading"
               InstancePrefix "loaded_classes"
               #InstanceFrom ""
               <Value>
                       Type "gauge"
                       InstancePrefix "loaded_classes"
                      #InstanceFrom ""
                       Table false
                       Attribute "LoadedClassCount"
               </Value>
       </MBean>
                # java runtime attributes
                <MBean "runtime">
                        ObjectName "java.lang:type=Runtime"
                        InstancePrefix "runtime"
                        #InstanceFrom ""
                        <Value>
                                Type "gauge"
                                InstancePrefix "JVM_uptime"
                                #InstanceFrom ""
                                Table false
                                Attribute "Uptime"
                        </Value>
                </MBean>                
       #WT Hadoop Data Node Metrics
       <MBean "data_node">
               ObjectName "Hadoop:service=DataNode,name=DataNode"
               #InstancePrefix ""
               InstanceFrom "name"
               <Value>
                       Type "counter"
                       InstancePrefix "blocks_read"
                       Attribute "blocks_read"
               </Value>
               <Value>
                       Type "counter"
                       InstancePrefix "blocks_removed"
                       Attribute "blocks_removed"
               </Value>
               <Value>
                       Type "counter"
                       InstancePrefix "blocks_replicated"
                       Attribute "blocks_replicated"
               </Value>
               <Value>
                       Type "counter"
                       InstancePrefix "blocks_verified"
                       Attribute "blocks_verified"
               </Value>
               <Value>
                       Type "counter"
                       InstancePrefix "blocks_written"
                       Attribute "blocks_written"
               </Value>
       </MBean>
       #WT Hadoop TaskTracker Metrics
       <MBean "task_tracker">
               ObjectName "Hadoop:service=TaskTracker,name=TaskTrackerMetrics"
               #InstancePrefix ""
               InstanceFrom "name"
               <Value>
                       Type "gauge"
                       InstancePrefix "maps_running"
                       Attribute "maps_running"
               </Value>
               <Value>
                       Type "gauge"
                       InstancePrefix "reduces_running"
                       Attribute "reduces_running"
               </Value>
               <Value>
                       Type "counter"
                       InstancePrefix "tasks_completed"
                       Attribute "tasks_completed"
               </Value>
       </MBean>
	#WT Hbase RPC 60020 stats
	<MBean "hbase_rpc_statistics">
		ObjectName "hadoop:service=HBase,name=RPCStatistics-60020"
		#InstancePrefix ""
		InstanceFrom "name"
		<Value>
			Type "gauge"
			InstancePrefix "ReceivedBytes"
			Attribute "ReceivedBytes"
		</Value>
		<Value>
			Type "gauge"
			InstancePrefix "SentBytes"
			Attribute "SentBytes"
		</Value>
		<Value>
			Type "gauge"
			InstancePrefix "getMaxTime"
			Attribute "getMaxTime"
		</Value>
		<Value>
			Type "gauge"
			InstancePrefix "get.aboveOneSec.AvgTime"
			Attribute "get.aboveOneSec.AvgTime"
		</Value>
		<Value>
			Type "gauge"
			InstancePrefix "get.aboveOneSec.NumOps"
			Attribute "get.aboveOneSec.NumOps"
		</Value>
		<Value>
			Type "gauge"
			InstancePrefix "replicateLogEntries.aboveOneSec.AvgTime"
			Attribute "replicateLogEntries.aboveOneSec.AvgTime"
		</Value>
		<Value>
			Type "gauge"
			InstancePrefix "replicateLogEntries.aboveOneSec.NumOps"
			Attribute "replicateLogEntries.aboveOneSec.NumOps"
		</Value>
		<Value>
			Type "gauge"
			InstancePrefix "rollHLogWriterAvgTime"
			Attribute "rollHLogWriterAvgTime"
		</Value>
	</MBean>
	#WT Region Server Statistics
	<MBean "region_server_statistics">
		ObjectName "hadoop:service=RegionServer,name=RegionServerStatistics"
		#InstancePrefix ""
		InstanceFrom "name"
		<Value>
			Type "gauge"
			InstancePrefix "compactionQueueSize"
			Attribute "compactionQueueSize"
		</Value>
		<Value>
			Type "gauge"
			InstancePrefix "compactionTimeAvgTime"
			Attribute "compactionTimeAvgTime"
		</Value>
		<Value>
			Type "gauge"
			InstancePrefix "flushQueueSize"
			Attribute "flushQueueSize"
		</Value>
		<Value>
			Type "gauge"
			InstancePrefix "regions"
			Attribute "regions"
		</Value>
		<Value>
			Type "gauge"
			InstancePrefix "requests"
			Attribute "requests"
		</Value>
		<Value>
			Type "gauge"
			InstancePrefix "stores"
			Attribute "stores"
		</Value>

		<Value>
			Type "counter"
			InstancePrefix "readRequestsCount"
			Attribute "readRequestsCount"
		</Value>
		<Value>
			Type "counter"
			InstancePrefix "writeRequestsCount"
			Attribute "writeRequestsCount"
		</Value>
	</MBean>


       #####################
       # Connection blocks #
       #####################
                #DataNode Connection
       <Connection>
               Host "<%= @node[:hostname] %>"
               ServiceURL "service:jmx:rmi:///jndi/rmi://localhost:8006/jmxrmi"
               Collect "classes"
               Collect "memory-heap"
               Collect "memory_nonheap"
               Collect "java_threads"
               Collect "garbage_collector"
                Collect "runtime"
               Collect "data_node"
       </Connection>
                #TaskTracker Connection
       <Connection>
               Host "<%= @node[:hostname] %>"
               ServiceURL "service:jmx:rmi:///jndi/rmi://localhost:8007/jmxrmi"
               Collect "task_tracker"
       </Connection>           
               #HBase RPC Statistics Connection
       <Connection>
               Host "<%= @node[:hostname] %>"
               ServiceURL "service:jmx:rmi:///jndi/rmi://localhost:10102/jmxrmi"
               Collect "hbase_rpc_statistics"
                Collect "region_server_statistics"
       </Connection>
       </Plugin>
</Plugin>
