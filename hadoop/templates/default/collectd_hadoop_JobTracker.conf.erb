##############################################################################
# This file is autogenerated by chef                                         #
#                                                                            #
# Collectd Hadoop Job Tracker plugin configuration file                      #
#----------------------------------------------------------------------------#
# By: Josh Behrends - Webtrends 2012                                         #
#                                                                            #
# Revisions: 05/23/2012 - Initial script creation                            #
#                                                                            #
##############################################################################
LoadPlugin java

<Plugin "java">
        JVMArg "-verbose:jni"
        JVMArg "-Djava.class.path=/usr/share/collectd/java/collectd-api.jar:/usr/share/collectd/java/generic-jmx.jar"
        LoadPlugin "org.collectd.java.GenericJMX"

        <Plugin "GenericJMX">
        ################
        # MBean blocks #
        ################
        # Memory usage by memory pool.
        <MBean "memory_pool">
                ObjectName "java.lang:type=MemoryPool,*"
                InstancePrefix "memory_pool-"
                InstanceFrom "name"
                <Value>
                        Type "memory"
                        #InstancePrefix ""
                        #InstanceFrom ""
                        Table true
                        Attribute "Usage"
                </Value>
        </MBean>
        # Heap memory usage
        <MBean "memory-heap">
                ObjectName "java.lang:type=Memory"
                #InstanceFrom ""
                InstancePrefix "memory-heap"
                # Creates four values: committed, init, max, used
                <Value>
                        Type "memory"
                        #InstancePrefix ""
                        #InstanceFrom ""
                        Table true
                        Attribute "HeapMemoryUsage"
                </Value>
        </MBean>
        # Non-heap memory usage
        <MBean "memory_nonheap">
                ObjectName "java.lang:type=Memory"
                #InstanceFrom ""
                InstancePrefix "memory-nonheap"
                # Creates four values: committed, init, max, used
                <Value>
                        Type "memory"
                        #InstancePrefix ""
                        #InstanceFrom ""
                        Table true
                        Attribute "NonHeapMemoryUsage"
                </Value>
        </MBean>
        # Non-heap memory usage
        <MBean "java_threads">
                ObjectName "java.lang:type=Threading"
                #InstanceFrom ""
                InstancePrefix "java_threads"
                <Value>
                        Type "gauge"
                        InstancePrefix "ThreadCount"
                        #InstanceFrom ""
                        Attribute "ThreadCount"
                </Value>
        </MBean>
        # Garbage Collector stats
        <MBean "garbage_collector">
                ObjectName "java.lang:type=GarbageCollector,*"
                InstancePrefix "gc-"
                InstanceFrom "name"
                <Value>
                        Type "invocations"
                        InstancePrefix "collection_count"
                        #InstanceFrom ""
                        Table false
                        Attribute "CollectionCount"
                </Value>
                <Value>
                        Type "total_time_in_ms"
                        InstancePrefix "collection_time"
                        #InstanceFrom ""
                        Table false
                        Attribute "CollectionTime"
                </Value>
        </MBean>
        # Number of classes being loaded.
        <MBean "classes">
                ObjectName "java.lang:type=ClassLoading"
                InstancePrefix "loaded_classes"
                #InstanceFrom ""
                <Value>
                        Type "gauge"
                        InstancePrefix "loaded_classes"
                        #InstanceFrom ""
                        Table false
                        Attribute "LoadedClassCount"
                </Value>
        </MBean>
		# java runtime attributes
		<MBean "runtime">
			ObjectName "java.lang:type=Runtime"
			InstancePrefix "runtime"
			#InstanceFrom ""
			<Value>
				Type "gauge"
				InstancePrefix "JVM_uptime"
				#InstanceFrom ""
				Table false
				Attribute "Uptime"
			</Value>
		</MBean>
        #WT Hadoop Job Tracker Metrics
        <MBean "task_tracker">
                ObjectName "Hadoop:service=JobTracker,name=JobTrackerMetrics"
                #InstancePrefix ""
                InstanceFrom "name"
                <Value>
                        Type "gauge"
                        InstancePrefix "jobs_running"
                        Attribute "jobs_running"
                </Value>
                <Value>
                        Type "counter"
                        InstancePrefix "jobs_submitted"
                        Attribute "jobs_submitted"
                </Value>
                <Value>
                        Type "gauge"
                        InstancePrefix "jobs_preparing"
                        Attribute "jobs_preparing"
                </Value>
                <Value>
                        Type "counter"
                        InstancePrefix "jobs_killed"
                        Attribute "jobs_killed"
                </Value>
                <Value>
                        Type "counter"
                        InstancePrefix "jobs_failed"
                        Attribute "jobs_failed"
                </Value>
                <Value>
                        Type "counter"
                        InstancePrefix "jobs_completed"
                        Attribute "jobs_completed"
                </Value>
                <Value>
                        Type "gauge"
                        InstancePrefix "trackers"
                        Attribute "trackers"
                </Value>
                <Value>
                        Type "gauge"
                        InstancePrefix "trackers_blacklisted"
                        Attribute "trackers_blacklisted"
                </Value>
                <Value>
                        Type "gauge"
                        InstancePrefix "trackers_decommissioned"
                        Attribute "trackers_decommissioned"
                </Value>
                <Value>
                        Type "gauge"
                        InstancePrefix "trackers_graylisted"
                        Attribute "trackers_graylisted"
                </Value>
        </MBean>
        #####################
        # Connection blocks #
        #####################
        <Connection>
                Host "<%= @node[:hostname] %>"
                ServiceURL "service:jmx:rmi:///jndi/rmi://localhost:8008/jmxrmi"
                Collect "classes"
                Collect "memory-heap"
                Collect "memory_nonheap"
                Collect "java_threads"
                Collect "garbage_collector"
				Collect "runtime"
                Collect "task_tracker"
        </Connection>
        </Plugin>
</Plugin>
